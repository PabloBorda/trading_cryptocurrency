from urllib.error import URLError
from urllib.request import Request, urlopen
import mechanize
import urllib.parse
import re
from tinydb import Query, TinyDB
import validators
from com_goldenthinker_trade_logger.Logger import Logger


Logger.log("Looking for interesting telegram signal channels on the web",telegram=True)
Logger.set_process_name('gt_find_telegram_channels_web_crawler')


def extract_telegram_channels(url):
    req = Request(
        url, 
        data=None, 
        headers={
            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.47 Safari/537.36'
        }
    )

    page = urlopen(req)
    html = page.read().decode("utf8")
    m = re.findall(r'https:\/\/(t(?:elegram)?\.(?:org|me|dog))\/(?:(joinchat\/[a-zA-Z0-9\-_]{22})|([a-zA-Z0-9\-_]+))', html,flags=re.I)
    result = []
    for match in m:
        result.append('https://' + (('/'.join(match)).replace('//','/')))
    return result



client = TinyDB('com_goldenthinker_trade_search/telegram_channels.json')

browser = mechanize.Browser()
browser.set_handle_robots(False)

user_agent = [('User-agent',
        'Mozilla/5.0 (X11;U;Linux 2.4.2.-2 i586; en-us;m18) Gecko/200010131 Netscape6/6.01'
        )]
browser.addheaders=user_agent



#search = ['free signals telegram','crypto signal telegram','binance telegram','bitcoin telegram','forex signals telegram','stock trade signals telegram','telegram channels signals']
search = ["trading telegram signals","crypto signals telegram","ultreos forex","forex signal telegram","free forex signals telegram 2020","free crypto signals telegram","forex telegram","telegram trading channels","binance pump signals","gold signals telegram","forex telegram group 2020","forex scalping signals telegram","free binance signals telegram","free vip forex signals telegram","forex vip signals telegram","us30 signals telegram","olymp trade signals telegram","forex telegram group chat","forex signal factory telegram","trading group telegram","cryptocurrency signals telegram","best forex signals telegram 2020","free trading signals telegram","binance futures signals telegram","best free forex signals telegram","iq option signals telegram","free gold signals telegram","free forex signals telegram 2021","best crypto trading signals telegram","verified crypto traders telegram","stock signals telegram","telegram forex signals free","best telegram crypto signals","best telegram forex signals","paid forex signals telegram","olymp trade telegram group","free signal crypto telegram","binany signals telegram","free daily forex trading signals telegram","best free crypto signals telegram","telegram trading signals","forex account management telegram","binance vip signals telegram","iq option free signals telegram","crypto signals telegram group","forex trading signals telegram","olymp trade signals telegram channel","binance telegram signals","best forex signal telegram group","forex guru telegram","forex signals free telegram","binance signal telegram","crypto telegram signals","forex telegram group chat 2020","best forex telegram channel","vip forex signals telegram","forex telegram group 2020 links","crypto trading signals telegram group","best free forex signals telegram 2020","olymp trade free signals telegram","free telegram crypto signals","free indices signals telegram","fx signal team telegram","volatility 75 index signals telegram","telegram to metatrader","crypto trade signals telegram","crypto signals group","binany trading signals telegram","xauusd free signal telegram","volatility 75 index free signals telegram","free signals forex telegram","coin signals telegram","best telegram channels for crypto trading","free crypto signals telegram group","best free crypto trading signals telegram","telegram to mt4 free","free crypto trading signals telegram","forex ea telegram","crypto vip signals telegram","telegram forex signals free 2020","best trading signals crypto","best forex telegram group","best xauusd signal telegram","myc signals telegram","free nasdaq signals telegram","free forex signals telegram group","crypto signals telegram channels","best trading signals telegram","synthetic indices signals telegram","day trading telegram group","signal olymp trade telegram","telegram binance signals","xauusd telegram","accurate forex signals free telegram","gold trading signals telegram","binance free signals telegram","binance trading signals telegram","free signal olymp trade telegram","the best crypto signals channels on telegram","telegram metatrader 4","crypto binance trading signals & pumps","binance premium signals telegram","mt4 telegram","daily forex signals telegram","volatility index free signals telegram","telegram crypto signals free","forex army free signals telegram","vip signals telegram","free crypto signals group","free crypto signals telegram reddit","free trading signals crypto","crypto signals telegram reddit","crypto quality signals telegram","btcusd signals telegram","myc forex & commodities signals","xauusd telegram group","best signal forex telegram","crypto trading signals group","telegram forex group","olymp trade vip signals telegram","universal crypto signals telegram","best forex signals telegram 2021","octafx signal telegram","crypto trading free signals telegram","m15 signals telegram","vix 75 signals telegram","nadex signals telegram","forex signal telegram free","olymp trade telegram","telegram forex group chat","signal telegram crypto","best gold signals telegram","metatrader 4 telegram group","signal forex percuma telegram","4c trading telegram","xauusd signal telegram free","gold forex signals telegram","crypto expert signals telegram","best crypto signals 2020","stock trading signals telegram","best paid crypto signals telegram","cornix auto trading","expert option signals telegram","free crypto signals telegram 2019","binance signal telegram channel","telegram signal crypto","telegram channel for crypto signals","crypto signals free telegram","olymp trade signals telegram group","fx telegram","free forex telegram signals","binany telegram group","stock market signals telegram","volatility signals telegram","xauusd signals telegram","eurusd signal telegram","forex community telegram","best telegram trading channels","binance trading telegram group","free forex trading signals telegram","best free crypto signal channel","trading group premium telegram","telegram group crypto signals","trade telegram group","best forex signals on telegram","forex trading telegram channel","forex group chat telegram","telegram channels for crypto trading","fxcapital exclusive signals telegram","telegram metatrader","best free telegram forex signals","free crypto signals channel","best telegram channels forex signals","premium crypto signals telegram","binany telegram","3commas telegram signals","best free forex signals telegram 2021","scalping signals telegram","best telegram channel for crypto signals","best free trading signals crypto","free crypto signals binance telegram","forex captain market telegram","mt4 telegram signal","best crypto trading telegram group","forex telegram chat group","binany telegram signal","forex free signal telegram","best crypto signals telegram free","free paid crypto signals","learn 2 trade telegram","free forex telegram group","best trading group on telegram","pocket option signals telegram","best paid forex signals telegram","nasdaq signals via telegram","best crypto signal channel","grup telegram trading forex","best telegram forex signals 2020","scalping telegram group","signal binance telegram","telegram channels for trading","best forex telegram signals","top crypto signals telegram","wa pro forex telegram","dow jones signals telegram","signal trading telegram","telegram olymp trade","step index signals telegram","best forex signal group","best cornix signals","free telegram signals","best binance futures signals telegram","forex chat room telegram","telegram stock signals","telegram gold signals","forex indicator telegram channel","best forex telegram channel 2020","forex trade telegram","wall street forex signals telegram","indices trading signals telegram","telegram forex channels","wti crude oil signals telegram","price action forex ltd telegram","grup telegram olymp trade","best free signal forex telegram","best forex signal telegram group 2020","forex signals telegram group free","expert option telegram group","best volatility index telegram channel","forex analysis telegram channel","best telegram channel for forex signals","best free telegram crypto signals","best free forex signal telegram group","forex signals telegram 2020","forex tips telegram","telegram paid forex signals","telegram trade signals","best free signals telegram","forex trading telegram group chat","free crypto signal telegram","free forex signals telegram 2019","best telegram signal forex","premium forex signals telegram","forex telegram group links","telegram free crypto signals","telegram signal to mt4","telegram forex signals reddit","best crypto signal channels on telegram","altsignals fx trading signals","fxlifestyle telegram","olymp trade signals group","us30 trading signals telegram","crypto free signals telegram","mt4 signal to telegram","mt5 signals telegram","best cryptocurrency signals telegram","volatility index free signals","telegram crypto trading signals","coinbase signals telegram","best binance signals telegram","xm signals telegram","us30 telegram signals","crypto signal channel","fbs signal telegram","trading signal telegram","forex signals pro telegram","telegram forex trading group","best forex signals group telegram","mql5 signals telegram","forex signal group telegram","vip binance signals","vix signals telegram","forex telegram signals free","iq option signals telegram group","free forex signals telegram channel","cfd signals telegram","gold signal forex telegram","trading signals telegram group","group signal forex telegram","scalping signal telegram","forex trading group telegram","best telegram channel for olymp trade","gold scalping telegram","telegram forex group links","telegram connector mt4","trading channels on telegram","forex profit pips ltd telegram","free trade signals telegram","binance signal telegram group","forex vip signals telegram free","learn2trade telegram","forex analysis telegram","telegram forex signals 2019","jkonfx telegram","olymp trade telegram channel","best forex trading signals telegram","index signals telegram","free vip signals telegram","mt4 signals telegram","binance signal group","xauusd telegram channel","free forex telegram","telegram iq option signals","forex amg telegram","telegram free signal forex","crypto technical analysis telegram","free forex telegram group 2020","volatility 75 index free signals","binomo signal telegram","deriv signals telegram","best telegram forex","signal factory telegram","top forex signals telegram","nasdaq telegram signals","best crypto signal telegram","ger30 signals telegram","forex factory telegram","binany free signals telegram","vip trading signals telegram","crypto forex signals telegram","best forex signal telegram channel","bitmex signals telegram","best crypto signal group","us30 signals telegram free","scalping telegram","best bitmex signals","free binance futures signals telegram","best forex channel on telegram","telegram trading signals group","cryptocurrency signals telegram group","telegram day trading","best forex telegram","forex index signals telegram","forex discussion group telegram","signals crypto telegram","forex trade signals telegram","gbpusd signal telegram","free telegram trading signals","jkonfx market analysis telegram","telegram mt4 signal trader","forex bank signals telegram","telegram pump channels","metatrader 5 telegram","best trading telegram group","best crypto telegram signals","telegram crypto signals group","forex live signals telegram","hfx signals telegram","signal cryptocurrency telegram","binance futures signals telegram free","pro crypto signals telegram","gold telegram signals","best telegram channels crypto signals","blue forex signals telegram","forex education telegram","trade signal telegram","signal iq option telegram","easy fx signals vip telegram","epic forex signals telegram","best forex trading telegram channel","best forex signal telegram group 2019","altcoins trading signals telegram","free telegram signals crypto","forex gdp telegram","forex tipster telegram","free gold forex signals telegram","the best free forex signals telegram","signal forex free telegram","forex trading signals telegram group","free mt5 indicators telegram","myc binance signals vip","best free telegram channel for forex signals","signal telegram forex","signal group crypto","free cryptocurrency signals telegram","xm free signals telegram","free forex telegram group chat","signal trading forex telegram","trading telegram channels","forex indicator telegram","metatrader telegram group","forex ea telegram group","group telegram signal forex","telegram xauusd","free scalping signals telegram","vip forex signals group","signal forex telegram free","price action signals telegram","trading alerts telegram","forex scalping signals free telegram","best telegram trading signals","live forex signals telegram","vip signal binance","account management forex telegram","telegram signal trading","best crypto signal channel telegram","best free binance signals","telegram forex signals channel","forex capital market telegram","best forex signal channel","forex signal channel","forex trade telegram group","trading forex telegram","free forex signal group telegram","blw signals group telegram","telegram channels crypto signals","binance crypto signals telegram","top free forex signals telegram","forex chat telegram","telegram free signals","iq option trading telegram group","bitmex telegram group","forex technical analysis and signals telegram","forex systems telegram","best telegram forex channels","accurate forex signals telegram","free pips telegram","free paid indicators telegram","crypto buy sell signals telegram","forex fundamental analysis telegram channel","telegram forex chat","pipsology forex signals telegram","metatrader telegram","best telegram channels for forex trading","best free trading signals telegram","best forex group on telegram","crypto scalping telegram","premium signals telegram","mt4 to telegram free","best telegram signals crypto","telegram free trading signals","free crypto signal channel","signal forex terbaik telegram","binance future telegram","price action forex telegram","telegram channel forex signal","nasdaq 100 free signals telegram","best forex signal group in telegram","us stock market signals telegram","nas100 telegram","telegram channels trading","best crypto signals group telegram","top telegram forex signals","silver signals telegram","crypto signal telegram free","best crypto trading channel telegram","forex telegram group 2019","ssj forex signals telegram","forex index ltd telegram","most accurate forex signals telegram","grup telegram signal olymp trade","forex scalping telegram channel","forex strategy telegram channel","hotforex signals telegram","signal trader telegram","binomo trading telegram group","forex channels on telegram","xauusd telegram signals","telegram channel trading","fx signals telegram","crypto trading channel telegram","forex gold signal telegram","gold forex telegram","forex strategies telegram","top forex signal telegram","best forex signals free telegram","best free forex signals on telegram","volatility 75 index telegram","best telegram group for forex signals","free signals telegram group","forex trader telegram","forex telegram group 2018","best crypto trading signal group","group trading forex telegram","telegram group cryptocurrency signals","binance vip signal","signal trading indodax telegram","best telegram group for trading","forex discussion telegram","best telegram free forex signals","ref wayne free signals telegram","forex setups telegram","free us30 signals telegram","binary signals telegram channel","etoro signals telegram","channel telegram signal forex","kucoin telegram signals","best telegram channels for trading signals","digital currency signal channel","telegram cryptocurrency signals","scalping forex telegram","forex premium signals telegram","forex signal channel telegram","grup telegram signal indodax","free signal forex telegram 2020","crypto signal alert telegram","best telegram forex signal channels","fundamental signals telegram","forex signals telegram channels","xm mt4 daily signals telegram","free signal iq option telegram","telegram scalping group","spx500 signals telegram","binany signals telegram group","crypto trading signal telegram","altsignals trading group","free forex telegram channel","crypto signals binance telegram","forex vip channel","telegram trade group","royal forex signals telegram","trading channels telegram","free nas100 signals telegram","free forex signals group","free forex course telegram","forex factory telegram channel","binance futures signal group","crypto signals group telegram","metatrader 5 signals telegram","best binance signals group"]


good_words = []
bad_words = []

for q in search:
    base_url = "http://duckduckgo.com/html/?q="
    query_url = base_url + q
    visit_link = urllib.parse.unquote(query_url)
    page = browser.open(visit_link)


    source_code = page.read()
    results = []
    results.extend(browser.links())
    for i in results:
        current_link = urllib.parse.unquote(i.url).split('&rut')[0][25:]
        if validators.url(current_link):
            try:
                Logger.log("Extract signal channels from website " + current_link)
                channels_found_in_website = extract_telegram_channels(current_link)
                Logger.log("Done")
                for c in channels_found_in_website:
                    channel_exists = Query()
                    if len(client.search(channel_exists.channel==c)) == 0:
                        client.insert({'channel': c})
                        Logger.log("Inserted: " + c)
            except URLError:
                Logger.log("Website " + current_link + " is not good. Continuing with others..")
    results = []

    
